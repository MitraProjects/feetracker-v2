<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fee Tracker (Student Self-Report)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
  --bg:#f6f8fb;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e5e7eb;

  /* Krishna Blue */
  --brand:#1e3a8a;      /* deep Krishna blue */
  --brand-600:#1d4ed8;  /* hover/active */
  --brand-50:#eef2ff;   /* subtle tint for tables */
}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 50% -200px, #eaf2ff 0%, rgba(234,242,255,0) 60%),
        var(--bg);
    }
  
    /* layout */
    #app{padding:20px}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 10px 30px rgba(2,8,23,.05);
      padding:18px;
      margin:14px auto;
      max-width:1100px;
    }
  
    /* header */
    .headerRow{
      display:grid;
      grid-template-columns:1fr auto 1fr;
      align-items:center;
      gap:12px;
      padding:10px 14px;
      background:linear-gradient(180deg, #ffffff, #fafcff);
    }
    .headerLeft h2{
      margin:0 0 6px 0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .headerLeft .muted{font-size:12px;color:var(--muted)}
    .headerCenter{display:flex; flex-direction:column; align-items:center}
    .headerCenter .muted{margin-top:6px; font-style:italic; color:#475569}
    .headerRight{display:flex; justify-content:flex-end; gap:8px; align-items:center}
  
    /* emblem */
    svg, .emblem{height:60px; width:auto}
  
    /* tabs (right side) */
    .tabs button{
  appearance:none;
  border:1px solid var(--border);
  background:#fff;
  color:var(--text);
  padding:8px 14px;
  border-radius:999px;
  cursor:pointer;
  font-size:13px;
  transition:all .15s ease;
}
.tabs button:hover{ background:var(--brand-50); }
.tabs button.active{
  background:var(--brand);
  border-color:var(--brand);
  color:#fff;
  box-shadow:0 4px 12px rgba(30,58,138,.25);
}

.btn{
  padding:10px 14px;
  border-radius:14px;
  font-size:14px;
  font-weight:500;
  cursor:pointer;
  transition:all .15s ease;
}
.btn.primary{
  background:var(--brand);
  border:1px solid var(--brand);
  color:#fff;
}
.btn.primary:hover{ background:var(--brand-600); border-color:var(--brand-600); }
.btn.outline{
  background:#fff;
  border:1px solid var(--brand);
  color:var(--brand);
}
.btn.outline:hover{ background:var(--brand-50); }

  
    /* controls */
    input,select,textarea{
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:14px;
      background:#fff;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--brand-600);
      box-shadow:0 0 0 3px var(--brand-50);
    }
  
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      padding:10px 14px;
      background:var(--brand);
      color:#fff;
      border:1px solid var(--brand);
      border-radius:12px;
      cursor:pointer;
      font-size:14px;
      transition:all .15s ease;
    }
    .btn:hover{background:var(--brand-600); border-color:var(--brand-600); transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .badge{display:inline-block;padding:.25rem .6rem;border-radius:999px;border:1px solid var(--border);background:#f1f5f9;font-size:12px}
  
    /* tables */
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; border:1px solid var(--border)}
    thead th{
      background:var(--brand-50);
      color:#0f172a;
      font-weight:600;
      font-size:13px;
      padding:10px;
      border-bottom:1px solid var(--border);
    }
    tbody td{
      padding:10px;
      border-top:1px solid var(--border);
      vertical-align:middle;
      font-size:14px;
    }
    tbody tr:nth-child(odd){background:#fcfdff}
    tbody tr:hover{background:#f9fbff}
  
    /* helper text */
    .muted{color:var(--muted)}
    .qr{max-width:160px;border:1px dashed var(--border);border-radius:10px;padding:6px;background:#fff}
  
    /* responsive */
    @media (max-width: 720px){
      .headerRow{grid-template-columns:1fr; text-align:center}
      .headerRight{justify-content:center}
      input,select,textarea{width:100%}
      .row{gap:8px}
      .tabs button{padding:8px 10px}
    }
    /* --- Krishna Blue theme + auth spacing polish --- */
:root{
  --brand:#1e3a8a;      /* Krishna blue (deep indigo) */
  --brand-600:#1d4ed8;  /* active/hover */
  --brand-50:#eef2ff;
}

/* widen and pad the login card */
.card.auth{
  max-width: 560px;         /* wider panel */
  padding: 28px 28px 26px;
}

/* larger gaps */
.form-row{ display:flex; flex-direction:column; gap:8px; margin-bottom:18px; }
.form-row label{ font-size:13px; color:var(--muted); }
.auth h2{ margin:0 0 16px 0; font-size:24px; }

/* button grid with comfy spacing */
.action-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
  margin-top:10px;
}

/* unified rounded buttons */
.btn{
  padding:12px 16px;
  border-radius:14px;
  font-size:14px;
}

/* primary vs outline */
.btn.primary{
  background:var(--brand);
  border-color:var(--brand);
  color:#fff;
}
.btn.primary:hover{ background:var(--brand-600); border-color:var(--brand-600); }

.btn.outline{
  background:#fff;
  border:1px solid var(--brand);
  color:var(--brand);
}
.btn.outline:hover{
  background:var(--brand-50);
}

/* inputs: a bit larger + better focus */
input[type="email"], input[type="password"]{
  padding:12px 14px;
  border-radius:12px;
  border:1px solid var(--border);
  font-size:14px;
}
input:focus{
  border-color:var(--brand-600);
  box-shadow:0 0 0 3px var(--brand-50);
  outline:none;
}

/* place helper note at the end in a single line */
.footer-note{
  max-width:560px;
  margin: 10px auto 0;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}

/* mobile: stack nicely */
@media (max-width: 520px){
  .card.auth{ padding:24px 18px; }
  .action-grid{ grid-template-columns: 1fr; }
}

  </style>
   
     
</head>
<body>
<div id="app"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

/* -------------- REQUIRED: your Firebase config -------------- */
const firebaseConfig = {
    apiKey: "AIzaSyAeW3aAFG-Ejffz84Zsy1SIHyM2Npx11I4",
    authDomain: "fee-tracker-v3.firebaseapp.com",
    projectId: "fee-tracker-v3",
    storageBucket: "fee-tracker-v3.firebasestorage.app",
    messagingSenderId: "728104140706",
    appId: "1:728104140706:web:13ac71568f9d3f959c7cfb",
    measurementId: "G-9Y44Y81DJ1"
  };

/* ------------------------------------------------------------ */

const appFB = initializeApp(firebaseConfig);
const auth = getAuth(appFB);
const db = getFirestore(appFB);
const googleProvider = new GoogleAuthProvider();

const appDiv = document.getElementById("app");
let currentUser = null;
let currentTab = "payments";
let currentRole = "student";

/* Catch ANY runtime errors (module syntax errors won’t reach this) */
window.addEventListener('error', e => {
  console.error('JS error:', e.message, e.error);
  alert('JS error: ' + e.message);
});
window.addEventListener('unhandledrejection', e => {
  console.error('Promise rejection:', e.reason);
  alert('Promise rejection: ' + (e.reason?.message || e.reason));
});

/* ---------- tiny DOM helper ---------- */
function el(tag, attrs={}, children=[]){
  const e = document.createElement(tag);
  for (let k in attrs){
    if (k === "class") e.className = attrs[k];
    else if (k.startsWith("on")) e.addEventListener(k.slice(2), attrs[k]);
    else e.setAttribute(k, attrs[k]);
  }
  (Array.isArray(children)?children:[children]).forEach(c=>e.appendChild(typeof c==="string"?document.createTextNode(c):c));
  return e;
}

/* ---------- login screen (your polished version) ---------- */
function loginScreen(){
  appDiv.innerHTML = "";
  const card = el("div",{class:"card auth"},[
    el("h2",{},"Sign in"),
    el("div",{class:"form-row"},[
      el("label",{for:"email"},"Email"),
      el("input",{id:"email",type:"email",placeholder:"you@example.com",autocomplete:"email"})
    ]),
    el("div",{class:"form-row"},[
      el("label",{for:"password"},"Password"),
      el("input",{id:"password",type:"password",placeholder:"••••••••",autocomplete:"current-password"})
    ]),
    el("div",{class:"action-grid"},[
      el("button",{class:"btn primary", onclick:()=>loginEmail()},"Sign in"),
      el("button",{class:"btn outline", onclick:()=>loginGoogle()},"Sign in with Google")
    ]),
    el("div",{class:"action-grid"},[
      el("button",{class:"btn outline", onclick:()=>resetEmail()},"Reset password"),
      el("button",{class:"btn primary", onclick:()=>signupEmail()},"Create account")
    ])
  ]);
  const note = el("div",{class:"footer-note"},
    "After creating an account, the admin will enroll you to subjects/batches."
  );
  appDiv.appendChild(card);
  appDiv.appendChild(note);
}

/* ---------- minimal header so we can see logged-in state ---------- */
function headerMinimal(){
  return el("div",{class:"card"},[
    el("h3",{},"Welcome"),
    el("div",{}, `Signed in as: ${currentUser?.email || ''}`),
    el("div",{}, `Role: ${currentRole}`),
    el("div",{class:"row", style:"margin-top:8px"},[
      el("button",{class:"btn outline", onclick:()=>signOut(auth)},"Logout")
    ])
  ]);
}

/* ---------- auth actions ---------- */
async function loginEmail(){
  const email = document.getElementById("email").value;
  const pw    = document.getElementById("password").value;
  await signInWithEmailAndPassword(auth, email, pw);
}
async function signupEmail(){
  const email = document.getElementById("email").value;
  const pw    = document.getElementById("password").value;
  const cred = await createUserWithEmailAndPassword(auth,email,pw);
  await setDoc(doc(db,"users",cred.user.uid),{role:"student",name:email,email});
  alert("Account created. You can sign in now.");
}
async function resetEmail(){
  const email = document.getElementById("email").value;
  if(!email){ alert("Enter your email first"); return; }
  await sendPasswordResetEmail(auth,email);
  alert("Reset link sent.");
}
/*async function loginGoogle(){
  const res = await signInWithPopup(auth, googleProvider);
  const uref = doc(db,"users",res.user.uid);
  const u = await getDoc(uref);
  if(!u.exists()) await setDoc(uref,{role:"student",name:res.user.displayName||res.user.email,email:res.user.email});
}*/
async function loginGoogle(){
  try {
    const res = await signInWithPopup(auth, googleProvider);
    const uref = doc(db,"users",res.user.uid);
    const u = await getDoc(uref);
    if(!u.exists()) {
      await setDoc(uref,{
        role:"student",
        name:res.user.displayName || res.user.email || "Student",
        email:res.user.email || ""
      });
    }
  } catch (e) {
    console.error("Google sign-in error:", e.code, e.message);
    alert("Google sign-in failed: " + e.code + "\n" +
      "Tips:\n" +
      "• Use your GitHub Pages URL or localhost (not file://)\n" +
      "• Enable Google provider in Firebase Auth\n" +
      "• Set a Support Email in Google provider\n" +
      "• Add your domain in Authorized domains");
  }
}


/* ---------- render (minimal) ---------- */
async function render(){
  if(!currentUser){ loginScreen(); return; }

  // ensure user doc exists and read role
  const uref = doc(db,"users", currentUser.uid);
  const ud = await getDoc(uref);
  if(!ud.exists()){
    await setDoc(uref,{ role:"student", name: currentUser.email, email: currentUser.email });
    currentRole = "student";
  }else{
    currentRole = ud.data().role || "student";
  }

  appDiv.innerHTML = "";
  appDiv.appendChild(headerMinimal());
  // (Later we’ll insert the full admin/student modules here)
}

/* ---------- app start ---------- */
onAuthStateChanged(auth, (user)=>{
  currentUser = user || null;
  render();
});

</script>
</body>
</html>
